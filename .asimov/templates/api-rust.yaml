# Enterprise Template: api-rust
# Migrated from asimov-plus v2.1.0
# Rust API with Axum, SQLx, Tower, and OpenAPI

identity:
  name: "{PROJECT_NAME}"
  type: backend-api
  tagline: "Rust API with Axum and Clean Architecture"

stack:
  framework: "Axum + SQLx + Tower + OpenAPI"
  language: "Rust"
  database: "PostgreSQL"

quality:
  test: "cargo test"
  lint: "cargo clippy"
  build: "cargo build --release"

structure:
  - src/main.rs              # Entry point
  - src/lib.rs               # Library root
  - src/config.rs            # Configuration
  - src/error.rs             # Error handling
  - src/routes/              # HTTP handlers
  - src/models/              # Domain models
  - src/services/            # Business logic
  - src/db/                  # Database layer
  - migrations/              # SQLx migrations
  - tests/                   # Integration tests
  - Cargo.toml
  - Dockerfile
  - docker-compose.yml

features:
  - Axum web framework
  - SQLx async database
  - Tower middleware (tracing, CORS)
  - utoipa OpenAPI/Swagger
  - thiserror for errors
  - Async PostgreSQL
  - Type-safe queries
  - Docker support

# v10.8.0: Database migrations guidance (ADR-062)
migrations:
  principle: "Migration complete = functionally equivalent, not just compiles"
  tool: "SQLx migrations (migrations/)"
  strategies:
    - test_parity: "Same tests pass before and after migration"
    - contract_testing: "Define input/output contracts, verify both satisfy"
    - behavioral_snapshots: "Capture old behavior as golden files"
    - shadow_mode: "Run both implementations, diff results"
  red_flags:
    - "Skipping tests for speed"
    - "Assuming compilation = correctness"
    - "Silent behavior changes"
